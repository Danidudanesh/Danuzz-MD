<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Danuzz-MD Pair Code</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <style>
    * { box-sizing: border-box; margin:0; padding:0; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    body {
      display:flex; justify-content:center; align-items:center; height:100vh;
      background: linear-gradient(135deg,#0f2027,#203a43,#2c5364); color:#fff;
    }
    .container { display:flex; flex-direction:column; align-items:center; }
    .box {
      width:350px; padding:25px; text-align:center;
      background: rgba(255,255,255,0.05); border-radius:15px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.5); backdrop-filter: blur(10px);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .box:hover { transform: translateY(-10px); box-shadow:0 15px 40px rgba(0,0,0,0.7); }
    h3 { font-size:1.4rem; margin-bottom:10px; }
    h6 { font-size:0.9rem; font-weight:normal; color:#ddd; margin-bottom:15px; }

    .input-container { display:flex; width:100%; border-radius:1rem; overflow:hidden; margin-top:10px; box-shadow:0 4px 15px rgba(0,0,0,0.3);}
    .input-container input { flex:1; padding:12px 15px; border:none; outline:none; font-size:1rem; background: rgba(0,0,0,0.3); color:#fff;}
    .input-container input::placeholder { color:#bbb; }
    .input-container button { padding:12px; background:#25d366; color:#fff; font-weight:bold; cursor:pointer; border:none; transition:0.3s; }
    .input-container button:hover { background:#128c7e; }

    #loading-spinner { display:none; margin-top:15px; font-size:1.5rem; color:#25d366; }
    .fa-spinner { animation: spin 1.5s linear infinite; }
    @keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }

    #pair { margin-top:20px; font-size:1.2rem; cursor:pointer; }
    @media(max-width:400px){ .box{width:90%;} .input-container{flex-direction:column;} .input-container button{width:100%;} }
  </style>
</head>
<body>
  <div class="container">
    <div class="box" id="box">
      <i class="fa fa-user-circle fa-3x" style="color:#25d366;"></i>
      <h3>Link Danuzz-MD with phone number</h3>
      <h6>üî¢ Enter your number with country code to pair with Danuzz-MD Web</h6>

      <div class="input-container">
        <input type="text" id="number" placeholder="+94704xxxxxx">
        <button id="submit">Submit</button>
      </div>

      <div id="loading-spinner"><i class="fas fa-spinner fa-spin"></i></div>
      <div id="pair"></div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.0.0-alpha.1/axios.min.js"></script>
  <script>
    const pairDisplay = document.getElementById("pair");
    const submitBtn = document.getElementById("submit");
    const numberInput = document.getElementById("number");
    const spinner = document.getElementById("loading-spinner");

    async function copyCode() {
      const codeText = document.getElementById("copy").innerText.replace('CODE: ','');
      await navigator.clipboard.writeText(codeText);
      const obj = document.getElementById("copy");
      obj.innerText = "‚úîÔ∏è COPIED";
      obj.style.color = "#00f";
      setTimeout(() => {
        obj.innerText = `CODE: ${codeText}`;
        obj.style.color = "#25d366";
      }, 800);
    }

    submitBtn.addEventListener("click", async () => {
      const number = numberInput.value.replace(/\D/g,'');
      if (!number) {
        pairDisplay.innerHTML = '<span style="color:#ff4d4d">‚ùóEnter your WhatsApp number with country code.</span>';
        return;
      }
      if (number.length < 10) {
        pairDisplay.innerHTML = '<span style="color:#ff4d4d">‚ùóInvalid number format. Try again.</span>';
        return;
      }

      numberInput.value = "+" + number;
      spinner.style.display = "block";
      pairDisplay.innerHTML = '';

      try {
        const { data } = await axios(`/code?number=${number}`);
        const code = data.code || "‚ùó Service Unavailable";
        pairDisplay.innerHTML = `<span id="copy" onclick="copyCode()" style="color:#25d366; font-weight:bold; cursor:pointer;">CODE: ${code}</span>`;
      } catch (err) {
        pairDisplay.innerHTML = '<span style="color:#ff4d4d">‚ùó Something went wrong. Try again.</span>';
      } finally {
        spinner.style.display = "none";
      }
    });
  </script>
</body>
</html>
